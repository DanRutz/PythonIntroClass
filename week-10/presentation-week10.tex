\documentclass{beamer}
%\usepackage[latin1]{inputenc}
\usetheme{Warsaw}
\title[Intro to Python: Week 10]{Introduction  to Python \\ Persistence / Serialization}
\author{Christopher Barker}
\institute{UW Continuing Education / Isilon}
\date{September 05, 2012}

\usepackage{listings}
\usepackage{hyperref}

\begin{document}

% ---------------------------------------------
\begin{frame}
  \titlepage
\end{frame}

% ---------------------------------------------
\begin{frame}
\frametitle{Table of Contents}
%\tableofcontents[currentsection]
  \tableofcontents
\end{frame}


\section{Review/Questions}

% ---------------------------------------------
\begin{frame}{Review of Previous Class}

Lightning talks today: Chris and John

\begin{itemize}
  \item doctests
  \item unittests
  \item profiling
\end{itemize}

\end{frame}


% header
% ---------------------------------------------
\begin{frame}{Homework review}

{\Large Homework notes: }

\vfill
{\large Anyone add some doctests or unittests to his project?}

\vfill
{\large Anyone time or profile their project?}

\vfill
{\large Did you find some bottlenecks??}

\end{frame}

\section{Serialization / Persistence}

% ---------------------------------------------
\begin{frame}[fragile]{Serialization}

\vfill
{\Large I'm focusing on methods available in the Python standard library}

\vfill
{\Large Serialization is the process of putting your potentially complex
(and nested) python data structures into a linear (serial) form .. i.e. a string of bytes}

\vfill
{\Large The serial form can be saved to a file, pushed over the wire, etc.}

\vfill

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Persistence}

\vfill
{\Large Persistence is saving your python data structure(s) to disk -- so they
will persist once the python process is finished.}

\vfill
{\Large Any serial form can provide persistence (by dumping/loading it to/from
a file), but not all persistence mechanisms are serial (i.e RDBMS)}


\vfill
\url{http://wiki.python.org/moin/PersistenceTools}
\end{frame} 


\section{Python Specific Formats}

% ---------------------------------------------
\begin{frame}[fragile]{Python Literals}

\vfill
{\Large Putting plain old python literals in your file}

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Pickle}

\vfill
{\Large Pickle is a binary format for python objects}

\vfill
{\Large You can essentially dump any python object to disk (or string, or socket, or...}

Example:
\begin{verbatim}
import pickle

data1 = {'a': [1, 2.0, 3, 4+6j],
         'b': ('string', u'Unicode string'),
         'c': None}

pickle.dump(open('data.pkl', 'wb'), output)
\end{verbatim}

{\Large \verb|cPickle| is faster than pickle, but
can't be customized -- you usually want \verb|cPickle|} 

\url{http://docs.python.org/library/pickle.html}
\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Shelve}

\vfill
{\Large A “shelf” is a persistent, dictionary-like object}

\vfill
{\Large The difference with “dbm” databases is that the values (not the keys!)
in a shelf can be essentially arbitrary Python objects}

\vfill
{\Large A shelf is essentially a "dbm" database with pickles as the values}

\vfill
{\Large NOTE: will not reflect changes in mutable objects without
   re-writing them to the db.}\\
   (or use writeback=True)

\vfill
{\Large Suffers from some of the same portability issues as \verb|anydbm|}

\vfill
{\Large If less that 100s of MB -- just use a dict and pickle it}

\vfill
\url{http://docs.python.org/library/shelve.html}
\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{Shelve}

\vfill
{\Large shelve example:}

\begin{verbatim}
import shelve

d = shelve.open(filename) 
d[key] = data   # store data at key 
data = d[key]   # retrieve a COPY of data at key 
del d[key]      # delete data stored at key 
flag = d.has_key(key)   # true if the key exists

# as d was opened WITHOUT writeback=True, beware:
d['xx'] = range(4)  # this works as expected, but...
d['xx'].append(5)   # *this doesn't!* -- d['xx'] is STILL range(4)!

# having opened d without writeback=True, you need to code carefully:
temp = d['xx']      # extracts the copy
temp.append(5)      # mutates the copy
d['xx'] = temp      # stores the copy right back, to persist it

d.close()       # close it
\end{verbatim}

\vfill
\url{http://docs.python.org/library/shelve.html}
\end{frame} 


\section{Interchange Formats} 

% ---------------------------------------------
\begin{frame}[fragile]{JSON}

\vfill
{\Large JSON (JavaScript Object Notation) is a subset of JavaScript syntax
        used as a lightweight data interchange format.}

\vfill
{\Large Python module has an interface similar to pickle}

\vfill
{\Large Can handle the standard Python data types}

\vfill
{\Large Specializable encoding/decoding for other types -- but I wouldn't do that!}


\vfill
\url{http://www.json.org/}\\
\url{http://docs.python.org/library/json.html}
\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{XML}

\vfill
{\Large XML is a standardized version of SGML, designed for use as a data
        storage/interchange format.}

\vfill
{\Large NOTE: HTML is also SGML, and modern versions conform to the XML standard.}

\vfill
{\Large XML looks like:}

\begin{verbatim} 
....
\end{verbatim} 

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{XML in the python std lib}


\vfill
{\Large \verb|xml.dom|: }

\vfill
{\Large \verb|xml.sax|: }

\vfill
{\Large \verb|xml.parsers.expat|: }

\vfill
{\Large \verb|xml.etree|: }
\url{http://docs.python.org/library/xml.etree.elementtree.html}

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{elementtree}


\vfill
{\Large  The Element type is a flexible container object, designed to store
hierarchical data structures in memory.}

\vfill
{\Large  Essentially an im-memory XML -- can be read from written-to XML}

\vfill
{\Large an \verb|ElementTree| is an entire XML doc}

\vfill
{\Large an \verb|Element| is a node in that tree}

\vfill
\url{http://docs.python.org/library/xml.etree.elementtree.html}

\end{frame} 


\begin{frame}[fragile]{INI}

{\Large INI files}

(the old Windows config files)

\begin{verbatim}
[Section1]
int = 15
bool = true
float = 3.1415

[Section2]
int = 32
...
\end{verbatim}
\vfill
{\Large Good for configuration data, etc.}
\end{frame}

\begin{frame}[fragile]{ConfigParser}

{\Large Writing \verb|ini| files:}

\begin{verbatim}
import ConfigParser
config = ConfigParser.ConfigParser()

config.add_section('Section1')
config.set('Section1', 'int', '15')
config.set('Section1', 'bool', 'true')
config.set('Section1', 'float', '3.1415')

# Writing our configuration file to 'example.cfg'
config.write( open('example.cfg', 'wb') )
\end{verbatim}

\vfill
Note: all keys and values are strings
\end{frame}

\begin{frame}[fragile]{ConfigParser}

{\Large Reading \verb|ini| files:}

\begin{verbatim}
>>> config = ConfigParser.ConfigParser()
>>> config.read('example.cfg')
>>> config.sections()
['Section1', 'Section2']

>>> config.get('Section1', 'float')
'3.1415'

>>> config.items('Section1')
[('int', '15'), ('bool', 'true'), ('float', '3.1415')]
\end{verbatim}

\vfill
\url{http://docs.python.org/library/configparser.html}
\end{frame}

\begin{frame}[fragile]{CSV}

{\Large CSV (Comma Separated Values) format is the
most common import and export format for spreadsheets and databases.}

\vfill
{\Large No real standard -- the Python csv package more or less follows MS Excel standard}

(with other "dialects" available)

\vfill
{\Large Can use delimiters other than commas...}\\
(I like tabs better)

\vfill
{\Large Most useful for simple tabular data}

\end{frame}

\begin{frame}[fragile]{CSV module}

{\Large Reading \verb|CSV| files:}

\begin{verbatim}
>>> import csv
>>> spamReader = csv.reader( open('eggs.csv', 'rb') )
>>> for row in spamReader:
...     print ', '.join(row)
Spam, Spam, Spam, Spam, Spam, Baked Beans
Spam, Lovely Spam, Wonderful Spam
\end{verbatim}

\vfill
{\verb|csv| module takes care of string quoting, etc. for you}

\vfill
\url{http://docs.python.org/library/csv.html}
\end{frame}



\begin{frame}[fragile]{CSV module}

{\Large Writing \verb|CSV| files:}

\begin{verbatim}
>>> import csv
>>> spamWriter = csv.writer(open('eggs.csv', 'wb'), 
                            quoting=csv.QUOTE_MINIMAL)
>>> spamWriter.writerow(['Spam'] * 5 + ['Baked Beans'])
>>> spamWriter.writerow(['Spam', 'Lovely Spam', 'Wonderful Spam'])
\end{verbatim}

\vfill
{\verb|csv| module takes care of string quoting, etc for you}

\vfill
\url{http://docs.python.org/library/csv.html}
\end{frame}




\section{DataBases} 

% ---------------------------------------------
\begin{frame}[fragile]{anydbm}

\vfill
{\Large \verb|anydbm| is a generic interface to variants of the DBM database (clones of the bsd dbm system)}

{\Large Suitable for storing data that fits well into a python dict with strings as both keys and values}

{\Large Note: anydbm will use the dbm system that works on your system --
        this may be different on different systems -- so the db files may NOT
        be compatible! \verb|whichdb| will try to figure it out, but it's not
        guaranteed}
\vfill
\url{http://docs.python.org/library/anydbm.html}
\end{frame} 

\begin{frame}[fragile]{anydbm module}

{\Large Writing data:}

\begin{verbatim}
#creating a dbm file:
anydbm.open(filename, 'n') 
\end{verbatim}

{\large flag options are: }
\begin{description}
  \item['r'] 	Open existing database for reading only (default)
  \item['w'] 	Open existing database for reading and writing
  \item['c'] 	Open database for reading and writing, creating it if it doesn’t exist
  \item['n'] 	Always create a new, empty database, open for reading and writing
\end{description}
\vfill
\url{http://docs.python.org/library/anydbm.html}
\end{frame}

\begin{frame}[fragile]{anydbm module}

{\Large \verb|dbm| provides dict-like interace:}

\begin{verbatim}
db = dbm.open("dbm", "c")

db["first"] = "bruce"
db["second"] = "micheal"
db["third"] = "fred"
db["second"] = "john" #overwrite
db.close()

# read it:
db = dbm.open("dbm", "r")
for key in db.keys():
    print key, db[key]
\end{verbatim}

\vfill
\url{http://docs.python.org/library/anydbm.html}
\end{frame}



% ---------------------------------------------
\begin{frame}[fragile]{sqlite}

\vfill
{\Large SQLite is a C library that provides a lightweight disk-based single-file database
        that doesn't require a separate server process and allows accessing the
        database using a nonstandard variant of the SQL query language}

\vfill
{\Large SQLite is very broadly used as as an embedded databases for storing
        application-specific data etc. (Picassa, Apple tools, on iOS/Android,
        small spatial databases, etc....}


\vfill
Firefox plug-in:\\
\url{https://addons.mozilla.org/en-US/firefox/addon/sqlite-manager/}
\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{DB-API}

\vfill
{\Large The DB-API spec (PEP 249) is a specification for interaction between Python and Relational Databases.}

\vfill
{\Large Support for a large number of third-party Database drivers:
\begin{itemize}
  \item MySQL
  \item PostgreSQL
  \item Oracle
  \item MSSQL (?)
  \item .....
\end{itemize}
}
\vfill
\url{http://www.python.org/dev/peps/pep-0249}
\end{frame} 


\section{Object-Relational Mappers}



\section{Object databases}

% ---------------------------------------------
\begin{frame}[fragile]{Object-Relation Mappers}

{\LARGE ORMs}

\vfill
{\Large Systems for mapping Python objects to tables in a RDBMS}

\vfill
{\Large Saves you writing that glue code (and the SQL) }

\vfill
{\Large usually deals with mapping to various back-end RDBMSs}

\vfill
{\Large  -- SQL Alchemy}\\ 
 -- \url{http://www.sqlalchemy.org/}

{\Large Django ORM}\\
\url{https://docs.djangoproject.com/en/dev/topics/db/}

\end{frame} 


% ---------------------------------------------
\begin{frame}[fragile]{Object Databases}

Python objects:
\begin{itemize}
  \item ZODB (\url{http://www.zodb.org/})
  \item Durus (\url{https://www.mems-exchange.org/software/DurusWorks/})
\end{itemize}

\end{frame} 

% ---------------------------------------------
\begin{frame}[fragile]{NoSQL}

Map-Reduce, etc....
What to say here???

Document-Oriented Storage: 
\begin{itemize}
  \item MongoDB (BSON inteface, JSON documents)
  \item CouchDB (Apache):
  \begin{itemize}
    \item  JSON documents
    \item  Javascript querying (MapReduce)  
    \item  HTTP API  
  \end{itemize}
\end{itemize}

\end{frame} 


%-------------------------------
\begin{frame}{LAB}

\begin{itemize}
  \item
\end{itemize}

\end{frame}

% Lightning Talk Slide
%-------------------------------
\begin{frame}{Lightning Talk}

{\centering

\vfill
{\LARGE Lightning Talk:  }

\vfill
{\Huge Chris}

\vfill
}
\end{frame}

% Lightning Talk Slide
%-------------------------------
\begin{frame}{Lightning Talk}

{\centering

\vfill
{\LARGE Lightning Talk:  }

\vfill
{\Huge Peter}

\vfill
}
\end{frame}


% ---------------------------------------------
\begin{frame}[fragile]{First Topic}

 {\Large A topic}

\begin{verbatim}
some code example
\end{verbatim}

\end{frame} 

%-------------------------------
\begin{frame}{LAB}

\begin{itemize}
  \item
\end{itemize}

\end{frame}

%-------------------------------
\begin{frame}{Wrap up}

\begin{itemize}
  \item
\end{itemize}

\end{frame}



%-------------------------------
\begin{frame}{Homework}

\vfill
{\Large Send me a copy of your project: due next Wed.}

\vfill
{\Large Keep learning about and using Python}
\vfill

\end{frame}


\end{document}

 
